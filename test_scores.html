<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Score Display</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">Test Score Display Issue</h1>
        
        <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Debug Score Display</h2>
            
            <button id="testScores" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg mb-4">
                Test Score Display
            </button>
            
            <div id="debugOutput" class="bg-gray-100 p-4 rounded-lg mb-4 hidden">
                <h3 class="font-semibold mb-2">Debug Output:</h3>
                <pre id="debugText" class="text-sm"></pre>
            </div>
            
            <!-- Resultados por sección - Copy from resultados.html -->
            <div class="mt-8">
                <h3 class="text-xl font-semibold mb-4 text-center">Resultados por Sección</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-yellow-500">
                        <h4 class="font-semibold text-gray-800">1. GOBIERNO Y CUMPLIMIENTO NORMATIVO</h4>
                        <p id="seccion-1" class="text-lg mt-2">Puntuación: --</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500">
                        <h4 class="font-semibold text-gray-800">2. GESTIÓN DE CONSENTIMIENTOS</h4>
                        <p id="seccion-2" class="text-lg mt-2">Puntuación: --</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-green-500">
                        <h4 class="font-semibold text-gray-800">3. MEDIDAS DE SEGURIDAD</h4>
                        <p id="seccion-3" class="text-lg mt-2">Puntuación: --</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-purple-500">
                        <h4 class="font-semibold text-gray-800">4. DERECHOS DE LOS TITULARES</h4>
                        <p id="seccion-4" class="text-lg mt-2">Puntuación: --</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500">
                        <h4 class="font-semibold text-gray-800">5. TRANSFERENCIAS DE DATOS</h4>
                        <p id="seccion-5" class="text-lg mt-2">Puntuación: --</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-pink-500">
                        <h4 class="font-semibold text-gray-800">6. GESTIÓN DE PROVEEDORES Y TERCEROS</h4>
                        <p id="seccion-6" class="text-lg mt-2">Puntuación: --</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-red-500 md:col-span-2">
                        <h4 class="font-semibold text-gray-800">7. GESTIÓN DE INCIDENTES Y CONTINUIDAD</h4>
                        <p id="seccion-7" class="text-lg mt-2">Puntuación: --</p>
                    </div>
                </div>
                
                <!-- Total Score Section -->
                <div class="mt-6 bg-gradient-to-r from-gray-100 to-gray-200 p-6 rounded-lg border-2 border-gray-300">
                    <div class="text-center">
                        <h4 class="text-xl font-bold text-gray-800 mb-2">PUNTUACIÓN TOTAL</h4>
                        <div class="flex justify-center items-center space-x-4">
                            <div class="bg-white px-4 py-2 rounded-lg shadow">
                                <span class="text-sm text-gray-600">Puntos:</span>
                                <span id="totalPuntos" class="text-2xl font-bold text-blue-600 ml-2">--/105</span>
                            </div>
                            <div class="bg-white px-4 py-2 rounded-lg shadow">
                                <span class="text-sm text-gray-600">Porcentaje:</span>
                                <span id="totalPorcentaje" class="text-2xl font-bold text-green-600 ml-2">--%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function debugLog(message) {
            console.log(message);
            const debugOutput = document.getElementById('debugOutput');
            const debugText = document.getElementById('debugText');
            debugOutput.classList.remove('hidden');
            debugText.textContent += message + '\n';
        }
        
        document.getElementById('testScores').addEventListener('click', function() {
            debugLog('=== TESTING SCORE DISPLAY ===');
            
            // Clear previous debug output
            document.getElementById('debugText').textContent = '';
            
            // Create test data
            debugLog('1. Creating test data...');
            localStorage.setItem("usuarioData", JSON.stringify({
                nombre: "Test",
                apellido: "User", 
                email: "test@example.com",
                empresa: "Test Company"
            }));
            
            // Create test section data
            const testSectionData = [
                [3, 2, 3, 1, 2], // Section 1: 11 points
                [2, 1, 2, 2, 1], // Section 2: 8 points  
                [3, 3, 3, 2, 3], // Section 3: 14 points
                [1, 2, 1, 1, 2], // Section 4: 7 points
                [3, 2, 3, 2, 2], // Section 5: 12 points
                [2, 2, 2, 3, 1], // Section 6: 10 points
                [2, 3, 2, 2, 2]  // Section 7: 11 points
            ];
            
            const sectionNames = ['seccion1Form', 'seccion2Form', 'seccion3Form', 'seccion4Form', 'seccion5Form', 'seccion6Form', 'seccion7Form'];
            
            testSectionData.forEach((data, index) => {
                localStorage.setItem(sectionNames[index], JSON.stringify(data));
                debugLog(`   ${sectionNames[index]}: ${JSON.stringify(data)} = ${data.reduce((a,b) => a+b, 0)} points`);
            });
            
            debugLog('2. Calculating results...');
            try {
                const resultados = calcularResultados();
                debugLog(`   Results calculated: ${JSON.stringify(resultados, null, 2)}`);
                
                if (resultados) {
                    debugLog('3. Calling displaySectionResults...');
                    displaySectionResults(resultados);
                    debugLog('   displaySectionResults completed');
                    
                    // Check if elements were updated
                    debugLog('4. Checking element updates...');
                    for (let i = 1; i <= 7; i++) {
                        const element = document.getElementById(`seccion-${i}`);
                        if (element) {
                            debugLog(`   seccion-${i}: "${element.textContent}"`);
                        } else {
                            debugLog(`   seccion-${i}: ELEMENT NOT FOUND`);
                        }
                    }
                    
                    const totalPuntos = document.getElementById('totalPuntos');
                    const totalPorcentaje = document.getElementById('totalPorcentaje');
                    debugLog(`   totalPuntos: "${totalPuntos ? totalPuntos.textContent : 'NOT FOUND'}"`);
                    debugLog(`   totalPorcentaje: "${totalPorcentaje ? totalPorcentaje.textContent : 'NOT FOUND'}"`);
                    
                } else {
                    debugLog('   ERROR: calcularResultados returned null');
                }
                
            } catch (error) {
                debugLog(`   ERROR: ${error.message}`);
                console.error('Error:', error);
            }
            
            debugLog('=== TEST COMPLETED ===');
        });
    </script>
</body>
</html> 